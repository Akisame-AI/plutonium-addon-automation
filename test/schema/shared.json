{
	"$schema": "http://json-schema.org/draft-07/schema#",
	"$id": "shared.json",
	"version": "0.5.3",

	"definitions": {
		"schema": {
			"description": "An optional key that allows you specify the schema you want to verify against in compatible IDEs.\nIt is  advised that you leave this key out when submitting to the repo.",
			"type": "string",
			"examples": [
				"../../../test/schema/homebrew.json",
				"../../../test/schema/core.json",
				"https://raw.githubusercontent.com/TheGiddyLimit/plutonium-addon-automation/master/test/schema/homebrew.json",
				"https://raw.githubusercontent.com/TheGiddyLimit/plutonium-addon-automation/master/test/schema/core.json"
			]
		},

		"foundrySystemObject": {
			"type": "object"
		},

		"foundryFlagsObject": {
			"type": "object"
		},

		"foundryEffectDurationObject": {
			"type": "object"
		},

		"foundryEffectObject": {
			"type": "object",
			"properties": {
				"name": {"type": "string"},
				"img": {"type": "string"},

				"requires": {
					"type": "object",
					"description": "Each key should correspond to a Foundry module's \"name\" field, which can be found in that module's \"module.json\" (or at the end of the Foundry module page URL, e.g. the \"JB2A_DnD5e\" in \"https://foundryvtt.com/packages/JB2A_DnD5e\")",

					"patternProperties": {
						"^.*$": {"const": true}
					},

					"propertyNames": {
						"not": {
							"$comment": "The modules listed here are module dependencies, so are implicitly required.",
							"enum": [
								"plutonium",
								"midi-qol",
								"dae",
								"times-up",
								"dfreds-convenient-effects"
							]
						}
					}
				},

				"changes": {
					"type": "array",
					"items": {
						"type": "object",
						"properties": {
							"key": {"type": "string"},
							"mode": {"type": ["string", "integer"], "enum": ["CUSTOM", 0, "MULTIPLY", 1, "ADD", 2, "DOWNGRADE", 3, "UPGRADE", 4, "OVERRIDE", 5]},
							"priority": {"type": ["string", "integer"]},
							"value": {"type": "string"}
						},
						"required": ["key", "mode", "value"],
						"additionalProperties": false
					},
					"uniqueItems": true,
					"minItems": 1
				},

				"flags": {"$ref": "#/definitions/foundryFlagsObject"},

				"duration": {"$ref": "#/definitions/foundryEffectDurationObject"},

				"disabled": {"const": true},
				"transfer": {"const": true}
			},
			"additionalProperties": false
		},

		"convenientEffectObject": {
			"type": "object",
			"properties": {
				"convenientEffect": {
					"description": "Generally taken from names in `game.dfreds.effects.conditions`.",
					"type": "string",
					"examples": [
						"Blinded",
						"Charmed",
						"Concentrating",
						"Deafened",
						"Exhaustion 1",
						"Exhaustion 2",
						"Exhaustion 3",
						"Exhaustion 4",
						"Exhaustion 5",
						"Frightened",
						"Grappled",
						"Incapacitated",
						"Invisible",
						"Paralyzed",
						"Petrified",
						"Poisoned",
						"Prone",
						"Restrained",
						"Stunned",
						"Unconscious"
					]
				},

				"flags": {"$ref": "#/definitions/foundryFlagsObject"},

				"duration": {"$ref": "#/definitions/foundryEffectDurationObject"}
			},
			"required": [
				"convenientEffect"
			],
			"additionalProperties": false
		},

		"effectObject": {
			"oneOf": [
				{"$ref": "#/definitions/foundryEffectObject"},
				{"$ref": "#/definitions/convenientEffectObject"}
			]
		},

		"foundrySideDataGeneric": {
			"type": "object",
			"properties": {
				"name": {"type": "string"},
				"source": {"type": "string"},

				"_TODO": {
					"description": "A free-text dev-only list of issues with the entity. This is useful for keeping track of as-yet-unsupported functionality.",
					"type": "array",
					"items": {"type": "string"}
				},

				"system": {"$ref": "#/definitions/foundrySystemObject"},

				"chooseSystem": {
					"oneOf": [
						{
							"type": "array",
							"uniqueItems": true,
							"items": {"$ref": "#/definitions/foundrySystemObject"},
							"minItems": 1
						},
						{"const": null}
					]
				},

				"isChooseSystemRenderEntries": {"type": "boolean"},

				"effects": {
					"type": "array",
					"items": {"$ref": "#/definitions/effectObject"},
					"uniqueItems": true,
					"minItems": 1
				},

				"flags": {"$ref": "#/definitions/foundryFlagsObject"},

				"chooseFlags": {
					"oneOf": [
						{
							"type": "array",
							"uniqueItems": true,
							"items": {"$ref": "#/definitions/foundryFlagsObject"},
							"minItems": 1
						},
						{"const": null}
					]
				},

				"isChooseFlagsRenderEntries": {"type": "boolean"},

				"img": {"type": "string"},

				"type": {
					"type": "string",
					"enum": [
						"weapon",
						"equipment",
						"consumable",
						"tool",
						"loot",
						"class",
						"spell",
						"feat",
						"backpack"
					]
				},

				"itemMacro": {"type": "string"},

				"_merge": {
					"type": "object",
					"description": "If our \"X\" (e.g. \"data\") should be merged with any base \"X\", rather than overwriting.",
					"properties": {
						"system": {"const": true},
						"chooseSystem": {"const": true},
						"effects": {"const": true},
						"flags": {"const": true},
						"chooseFlags": {"const": true}
					}
				}
			},
			"required": [
				"name",
				"source"
			],
			"minProperties": 3
		},

		"foundrySideDataGenericArray": {
			"type": "array",
			"uniqueItems": true,
			"items": {"$ref": "#/definitions/foundrySideDataGeneric"},
			"minItems": 1
		},

		"subclass": {
			"type": "array",
			"items": {
				"allOf": [
					{"$ref": "#/definitions/foundrySideDataGeneric"},
					{
						"type": "object",
						"properties": {
							"className": {"type": "string"},
							"classSource": {"type": "string"}
						},
						"required": [
							"name",
							"source",
							"className",
							"classSource"
						],
						"minProperties": 5
					}
				]
			},
			"uniqueItems": true,
			"minItems": 1
		},

		"raceFeature": {
			"type": "array",
			"items": {
				"allOf": [
					{"$ref": "#/definitions/foundrySideDataGeneric"},
					{
						"type": "object",
						"properties": {
							"raceName": {"type": "string"},
							"raceSource": {"type": "string"}
						},
						"required": [
							"name",
							"source",
							"raceName",
							"raceSource"
						],
						"minProperties": 5
					}
				]
			},
			"uniqueItems": true,
			"minItems": 1
		},

		"backgroundFeature": {
			"type": "array",
			"items": {
				"allOf": [
					{"$ref": "#/definitions/foundrySideDataGeneric"},
					{
						"type": "object",
						"properties": {
							"backgroundName": {"type": "string"},
							"backgroundSource": {"type": "string"}
						},
						"required": [
							"name",
							"source",
							"backgroundName",
							"backgroundSource"
						],
						"minProperties": 5
					}
				]
			},
			"uniqueItems": true,
			"minItems": 1
		},

		"classFeature": {
			"type": "array",
			"items": {
				"allOf": [
					{"$ref": "#/definitions/foundrySideDataGeneric"},
					{
						"type": "object",
						"properties": {
							"className":  {"type": "string"},
							"classSource": {"type": "string"},
							"level":  {"type": "integer"}
						},
						"required": [
							"name",
							"source",
							"className",
							"classSource",
							"level"
						],
						"minProperties": 6
					}
				]
			},
			"uniqueItems": true,
			"minItems": 1
		},

		"subclassFeature": {
			"type": "array",
			"items": {
				"allOf": [
					{"$ref": "#/definitions/foundrySideDataGeneric"},
					{
						"type": "object",
						"properties": {
							"className":  {"type": "string"},
							"classSource": {"type": "string"},
							"level":  {"type": "integer"},
							"subclassShortName": {"type": "string"},
							"subclassSource": {"type": "string"}
						},
						"required": [
							"name",
							"source",
							"className",
							"classSource",
							"level",
							"subclassShortName",
							"subclassSource"
						],
						"minProperties": 8
					}
				]
			},
			"uniqueItems": true,
			"minItems": 1
		},

		"psionicDisciplineActive": {
			"type": "array",
			"items": {
				"allOf": [
					{"$ref": "#/definitions/foundrySideDataGeneric"},
					{
						"type": "object",
						"properties": {
							"psionicName": {"type": "string"},
							"psionicSource": {"type": "string"}
						},
						"required": [
							"name",
							"source",
							"psionicName",
							"psionicSource"
						],
						"minProperties": 5
					}
				]
			},
			"uniqueItems": true,
			"minItems": 1
		},

		"vehicleWeapon": {
			"type": "array",
			"items": {
				"allOf": [
					{"$ref": "#/definitions/foundrySideDataGeneric"},
					{
						"type": "object",
						"properties": {
							"vehicleName": {"type": "string"},
							"vehicleSource": {"type": "string"}
						},
						"required": [
							"name",
							"source",
							"vehicleName",
							"vehicleSource"
						],
						"minProperties": 5
					}
				]
			},
			"uniqueItems": true,
			"minItems": 1
		}
	}
}
